image: "ruby:2.6"

variables:
  KNAPSACK_PRO_REPO_PATH: ~/gems/knapsack_pro-ruby

before_script:
  - apt-get update -qq && apt-get install -y -qq sqlite3 libsqlite3-dev nodejs
  - ruby -v
  - which ruby

  # clone knapsack_pro gem repo
  - mkdir ~/gems
  - cd ~/gems && (git clone -b $CI_COMMIT_REF_NAME --single-branch git@github.com:KnapsackPro/knapsack_pro-ruby.git || git clone -b master --single-branch git@github.com:KnapsackPro/knapsack_pro-ruby.git)
  - cd ~/gems/knapsack_pro-ruby && git branch
  - cd ~/gems/knapsack_pro-ruby && git log -n 1 | more

  - gem install bundler --no-document
  - bundle install --jobs $(nproc)  "${FLAGS[@]}"

rspec:
  script:
    - bundle exec rspec
